class K{buffer;position=0;lineNumber=1;constructor(t){this.buffer=t}*scanEntities(){for(this.position=0,this.lineNumber=1;this.position<this.buffer.length;)if(this.buffer[this.position]===35){const t=this.position,s=this.lineNumber,n=this.readExpressId();if(n===null){this.position++;continue}if(this.skipWhitespace(),this.position>=this.buffer.length||this.buffer[this.position]!==61){this.position++;continue}this.position++,this.skipWhitespace();const r=this.readTypeName();if(!r){this.position++;continue}if(this.skipWhitespace(),this.position>=this.buffer.length||this.buffer[this.position]!==40){this.position++;continue}const o=this.findEntityLength(t);o>0&&(yield{expressId:n,type:r,offset:t,length:o,line:s})}else this.buffer[this.position]===10?(this.lineNumber++,this.position++):this.position++}*scanEntitiesFast(){this.position=0,this.lineNumber=1;const t=35,s=61,n=40,r=59,o=39,c=10,a=this.buffer,u=a.length;let i=0,p=1;for(;i<u;){const y=a[i];if(y===t){const I=i,g=p;i++;let d=0,l=!1;for(;i<u;){const f=a[i];if(f>=48&&f<=57)d=d*10+(f-48),l=!0,i++;else break}if(!l)continue;for(;i<u;){const f=a[i];if(f===32||f===9||f===13)i++;else if(f===c)p++,i++;else break}if(i>=u||a[i]!==s)continue;for(i++;i<u;){const f=a[i];if(f===32||f===9||f===13)i++;else if(f===c)p++,i++;else break}const h=i;if(i>=u||a[i]<65||a[i]>90)continue;for(;i<u;){const f=a[i];if(f>=65&&f<=90||f>=97&&f<=122||f>=48&&f<=57||f===95)i++;else break}if(i===h)continue;const C=String.fromCharCode(...a.subarray(h,i));for(;i<u;){const f=a[i];if(f===32||f===9||f===13)i++;else if(f===c)p++,i++;else break}if(i>=u||a[i]!==n)continue;let E=!1;for(;i<u;){const f=a[i];if(f===o){if(E&&i+1<u&&a[i+1]===o){i+=2;continue}E=!E}else if(f===r&&!E){const A=i-I+1;yield{expressId:d,type:C,offset:I,length:A,line:g},i++;break}else f===c&&p++;i++}}else y===c&&p++,i++}this.position=i,this.lineNumber=p}readExpressId(){let t=0,s=0,n=this.position+1;for(;n<this.buffer.length;){const r=this.buffer[n];if(r>=48&&r<=57)t=t*10+(r-48),s++,n++;else break}return s===0?null:(this.position=n,t)}readTypeName(){let t=this.position,s=t;if(this.position>=this.buffer.length||this.buffer[this.position]<65||this.buffer[this.position]>90)return null;for(;s<this.buffer.length;){const r=this.buffer[s];if(r>=65&&r<=90||r>=97&&r<=122||r>=48&&r<=57||r===95)s++;else break}if(s===t)return null;const n=new TextDecoder().decode(this.buffer.subarray(t,s));return this.position=s,n}skipWhitespace(){for(;this.position<this.buffer.length;){const t=this.buffer[this.position];if(t===32||t===9||t===13||t===10)t===10&&this.lineNumber++,this.position++;else break}}findEntityLength(t){let s=this.position,n=0,r=!1;for(;s<this.buffer.length;){const o=this.buffer[s];if(o===39){if(r){if(s+1<this.buffer.length&&this.buffer[s+1]===39){s+=2;continue}r=!1}else r=!0;s++;continue}if(r){s++;continue}if(o===40)n++,s++;else if(o===41){if(n--,s++,n===0)return s-t}else s++}return 0}}class et{byId=new Map;byType=new Map;addEntity(t){this.byId.set(t.expressId,t);let s=this.byType.get(t.type);s||(s=[],this.byType.set(t.type,s)),s.push(t.expressId)}build(){return{byId:this.byId,byType:this.byType}}}class G{buffer;constructor(t){this.buffer=t}extractEntity(t){try{const n=new TextDecoder().decode(this.buffer.subarray(t.byteOffset,t.byteOffset+t.byteLength)).match(/^#(\d+)\s*=\s*(\w+)\((.*)\)/);if(!n)return null;const r=parseInt(n[1],10),o=n[2],c=n[3],a=this.parseAttributes(c);return{expressId:r,type:o,attributes:a}}catch(s){return console.warn(`Failed to extract entity #${t.expressId}:`,s),null}}parseAttributes(t){if(!t.trim())return[];const s=[];let n=0,r="",o=!1;for(let c=0;c<t.length;c++){const a=t[c];if(a==="'"){if(o){if(c+1<t.length&&t[c+1]==="'"){r+="''",c++;continue}o=!1}else o=!0;r+=a}else o?r+=a:a==="("?(n++,r+=a):a===")"?(n--,r+=a):a===","&&n===0?(s.push(this.parseAttributeValue(r.trim())),r=""):r+=a}return r.trim()&&s.push(this.parseAttributeValue(r.trim())),s}parseAttributeValue(t){if(t=t.trim(),!t||t==="$")return null;const s=t.match(/^([A-Z][A-Z0-9_]*)\((.+)\)$/i);if(s){const r=s[1],o=s[2].trim();return[r,this.parseAttributeValue(o)]}if(t.startsWith("(")&&t.endsWith(")")){const r=t.slice(1,-1).trim();if(!r)return[];const o=[];let c=0,a="";for(let u=0;u<r.length;u++){const i=r[u];if(i==="(")c++,a+=i;else if(i===")")c--,a+=i;else if(i===","&&c===0){const p=a.trim();p&&o.push(this.parseAttributeValue(p)),a=""}else a+=i}return a.trim()&&o.push(this.parseAttributeValue(a.trim())),o}if(t.startsWith("#")){const r=parseInt(t.substring(1),10);return isNaN(r)?null:r}if(t.startsWith("'")&&t.endsWith("'"))return t.slice(1,-1).replace(/''/g,"'");const n=parseFloat(t);return isNaN(n)?t:n}}class st{entities;constructor(t){this.entities=t}async extractPropertySetsAsync(){const t=new Map;let s=0;for(const[n,r]of this.entities){if(r.type.toUpperCase()==="IFCPROPERTYSET"){const o=this.extractPropertySet(r);o&&t.set(n,o)}s++,s%2e3===0&&await new Promise(o=>setTimeout(o,0))}return t}extractPropertySets(){const t=new Map;for(const[s,n]of this.entities)if(n.type.toUpperCase()==="IFCPROPERTYSET"){const r=this.extractPropertySet(n);r&&t.set(s,r)}return t}extractPropertySet(t){try{const s=this.getAttributeValue(t,2);if(!s)return null;const n=this.getAttributeValue(t,4),r=new Map;if(Array.isArray(n)){for(const o of n)if(typeof o=="number"){const c=this.entities.get(o);if(c){const a=this.extractProperty(c);a&&r.set(a.name,a.value)}}}return{name:s,properties:r}}catch(s){return console.warn(`Failed to extract PropertySet #${t.expressId}:`,s),null}}extractProperty(t){try{const s=this.getAttributeValue(t,0);if(!s)return null;const n=this.getAttributeValue(t,2),r=this.parsePropertyValue(n);return{name:s,value:r}}catch(s){return console.warn(`Failed to extract property #${t.expressId}:`,s),null}}parsePropertyValue(t){return t==null?{type:"null",value:null}:typeof t=="number"?{type:"number",value:t}:typeof t=="boolean"?{type:"boolean",value:t}:typeof t=="string"?{type:"string",value:t}:typeof t=="number"&&t<0?{type:"reference",value:t}:{type:"string",value:String(t)}}getAttributeValue(t,s){return s<0||s>=t.attributes.length?null:t.attributes[s]}}class nt{entities;constructor(t){this.entities=t}async extractRelationshipsAsync(){const t=[],s=new Map;let n=0;for(const[,r]of this.entities){const o=r.type.toUpperCase();o.startsWith("IFCREL")&&s.set(o,(s.get(o)||0)+1);const c=this.extractRelationship(r);c&&t.push(c),n++,n%2e3===0&&await new Promise(a=>setTimeout(a,0))}return console.log("[RelationshipExtractor] Relationship type counts:",Object.fromEntries(s)),console.log("[RelationshipExtractor] Successfully extracted:",t.length),t}extractRelationships(){const t=[],s=new Map;for(const[,n]of this.entities){const r=n.type.toUpperCase();r.startsWith("IFCREL")&&s.set(r,(s.get(r)||0)+1);const o=this.extractRelationship(n);o&&t.push(o)}return console.log("[RelationshipExtractor] Relationship type counts:",Object.fromEntries(s)),console.log("[RelationshipExtractor] Successfully extracted:",t.length),t}extractRelationship(t){const s=t.type.toUpperCase();if(!["IFCRELCONTAINEDINSPATIALSTRUCTURE","IFCRELAGGREGATES","IFCRELDEFINESBYPROPERTIES","IFCRELDEFINESBYTYPE","IFCRELASSOCIATESMATERIAL","IFCRELVOIDSELEMENT","IFCRELFILLSELEMENT"].includes(s))return null;try{let r,o;return s==="IFCRELDEFINESBYPROPERTIES"?(o=this.getAttributeValue(t,4),r=this.getAttributeValue(t,5)):s==="IFCRELCONTAINEDINSPATIALSTRUCTURE"?(o=this.getAttributeValue(t,4),r=this.getAttributeValue(t,5)):(r=this.getAttributeValue(t,4),o=this.getAttributeValue(t,5)),r===null||typeof r!="number"||!Array.isArray(o)?null:{type:t.type,relatingObject:r,relatedObjects:o.filter(c=>typeof c=="number")}}catch(r){return console.warn(`Failed to extract relationship #${t.expressId}:`,r),null}}getAttributeValue(t,s){return s<0||s>=t.attributes.length?null:t.attributes[s]}}class rt{strings=[""];index=new Map([["",0]]);NULL_INDEX=-1;get count(){return this.strings.length}get(t){return t<0||t>=this.strings.length?"":this.strings[t]}intern(t){if(t==null)return this.NULL_INDEX;const s=this.index.get(t);if(s!==void 0)return s;const n=this.strings.length;return this.strings.push(t),this.index.set(t,n),n}has(t){return this.index.has(t)}indexOf(t){return this.index.get(t)??-1}getAll(){return[...this.strings]}}var O=(e=>(e[e.IfcProject=1]="IfcProject",e[e.IfcSite=2]="IfcSite",e[e.IfcBuilding=3]="IfcBuilding",e[e.IfcBuildingStorey=4]="IfcBuildingStorey",e[e.IfcSpace=5]="IfcSpace",e[e.IfcWall=10]="IfcWall",e[e.IfcWallStandardCase=11]="IfcWallStandardCase",e[e.IfcDoor=12]="IfcDoor",e[e.IfcWindow=13]="IfcWindow",e[e.IfcSlab=14]="IfcSlab",e[e.IfcColumn=15]="IfcColumn",e[e.IfcBeam=16]="IfcBeam",e[e.IfcStair=17]="IfcStair",e[e.IfcRamp=18]="IfcRamp",e[e.IfcRoof=19]="IfcRoof",e[e.IfcCovering=20]="IfcCovering",e[e.IfcCurtainWall=21]="IfcCurtainWall",e[e.IfcRailing=22]="IfcRailing",e[e.IfcOpeningElement=30]="IfcOpeningElement",e[e.IfcDistributionElement=40]="IfcDistributionElement",e[e.IfcFlowTerminal=41]="IfcFlowTerminal",e[e.IfcFlowSegment=42]="IfcFlowSegment",e[e.IfcFlowFitting=43]="IfcFlowFitting",e[e.IfcRelContainedInSpatialStructure=100]="IfcRelContainedInSpatialStructure",e[e.IfcRelAggregates=101]="IfcRelAggregates",e[e.IfcRelDefinesByProperties=102]="IfcRelDefinesByProperties",e[e.IfcRelDefinesByType=103]="IfcRelDefinesByType",e[e.IfcRelAssociatesMaterial=104]="IfcRelAssociatesMaterial",e[e.IfcRelAssociatesClassification=105]="IfcRelAssociatesClassification",e[e.IfcRelVoidsElement=106]="IfcRelVoidsElement",e[e.IfcRelFillsElement=107]="IfcRelFillsElement",e[e.IfcRelConnectsPathElements=108]="IfcRelConnectsPathElements",e[e.IfcRelSpaceBoundary=109]="IfcRelSpaceBoundary",e[e.IfcPropertySet=200]="IfcPropertySet",e[e.IfcPropertySingleValue=201]="IfcPropertySingleValue",e[e.IfcPropertyEnumeratedValue=202]="IfcPropertyEnumeratedValue",e[e.IfcPropertyBoundedValue=203]="IfcPropertyBoundedValue",e[e.IfcPropertyListValue=204]="IfcPropertyListValue",e[e.IfcElementQuantity=210]="IfcElementQuantity",e[e.IfcQuantityLength=211]="IfcQuantityLength",e[e.IfcQuantityArea=212]="IfcQuantityArea",e[e.IfcQuantityVolume=213]="IfcQuantityVolume",e[e.IfcQuantityCount=214]="IfcQuantityCount",e[e.IfcQuantityWeight=215]="IfcQuantityWeight",e[e.IfcWallType=300]="IfcWallType",e[e.IfcDoorType=301]="IfcDoorType",e[e.IfcWindowType=302]="IfcWindowType",e[e.IfcSlabType=303]="IfcSlabType",e[e.IfcColumnType=304]="IfcColumnType",e[e.IfcBeamType=305]="IfcBeamType",e[e.Unknown=9999]="Unknown",e))(O||{}),T=(e=>(e[e.String=0]="String",e[e.Real=1]="Real",e[e.Integer=2]="Integer",e[e.Boolean=3]="Boolean",e[e.Logical=4]="Logical",e[e.Label=5]="Label",e[e.Identifier=6]="Identifier",e[e.Text=7]="Text",e[e.Enum=8]="Enum",e[e.Reference=9]="Reference",e[e.List=10]="List",e))(T||{}),D=(e=>(e[e.Length=0]="Length",e[e.Area=1]="Area",e[e.Volume=2]="Volume",e[e.Count=3]="Count",e[e.Weight=4]="Weight",e[e.Time=5]="Time",e))(D||{}),R=(e=>(e[e.ContainsElements=1]="ContainsElements",e[e.Aggregates=2]="Aggregates",e[e.DefinesByProperties=10]="DefinesByProperties",e[e.DefinesByType=11]="DefinesByType",e[e.AssociatesMaterial=20]="AssociatesMaterial",e[e.AssociatesClassification=30]="AssociatesClassification",e[e.ConnectsPathElements=40]="ConnectsPathElements",e[e.FillsElement=41]="FillsElement",e[e.VoidsElement=42]="VoidsElement",e[e.ConnectsElements=43]="ConnectsElements",e[e.SpaceBoundary=50]="SpaceBoundary",e[e.AssignsToGroup=60]="AssignsToGroup",e[e.AssignsToProduct=61]="AssignsToProduct",e[e.ReferencedInSpatialStructure=70]="ReferencedInSpatialStructure",e))(R||{}),j=(e=>(e[e.HAS_GEOMETRY=1]="HAS_GEOMETRY",e[e.HAS_PROPERTIES=2]="HAS_PROPERTIES",e[e.HAS_QUANTITIES=4]="HAS_QUANTITIES",e[e.IS_TYPE=8]="IS_TYPE",e[e.IS_EXTERNAL=16]="IS_EXTERNAL",e[e.HAS_OPENINGS=32]="HAS_OPENINGS",e[e.IS_FILLING=64]="IS_FILLING",e))(j||{});const it=new Map([["IFCPROJECT",1],["IFCSITE",2],["IFCBUILDING",3],["IFCBUILDINGSTOREY",4],["IFCSPACE",5],["IFCWALL",10],["IFCWALLSTANDARDCASE",11],["IFCDOOR",12],["IFCWINDOW",13],["IFCSLAB",14],["IFCCOLUMN",15],["IFCBEAM",16],["IFCSTAIR",17],["IFCRAMP",18],["IFCROOF",19],["IFCCOVERING",20],["IFCCURTAINWALL",21],["IFCRAILING",22],["IFCOPENINGELEMENT",30],["IFCDISTRIBUTIONELEMENT",40],["IFCFLOWTERMINAL",41],["IFCFLOWSEGMENT",42],["IFCFLOWFITTING",43],["IFCRELCONTAINEDINSPATIALSTRUCTURE",100],["IFCRELAGGREGATES",101],["IFCRELDEFINESBYPROPERTIES",102],["IFCRELDEFINESBYTYPE",103],["IFCRELASSOCIATESMATERIAL",104],["IFCRELASSOCIATESCLASSIFICATION",105],["IFCRELVOIDSELEMENT",106],["IFCRELFILLSELEMENT",107],["IFCRELCONNECTSPATHELEMENTS",108],["IFCRELSPACEBOUNDARY",109],["IFCPROPERTYSET",200],["IFCPROPERTYSINGLEVALUE",201],["IFCPROPERTYENUMERATEDVALUE",202],["IFCPROPERTYBOUNDEDVALUE",203],["IFCPROPERTYLISTVALUE",204],["IFCELEMENTQUANTITY",210],["IFCQUANTITYLENGTH",211],["IFCQUANTITYAREA",212],["IFCQUANTITYVOLUME",213],["IFCQUANTITYCOUNT",214],["IFCQUANTITYWEIGHT",215],["IFCWALLTYPE",300],["IFCDOORTYPE",301],["IFCWINDOWTYPE",302],["IFCSLABTYPE",303],["IFCCOLUMNTYPE",304],["IFCBEAMTYPE",305]]),ot=new Map([[1,"IfcProject"],[2,"IfcSite"],[3,"IfcBuilding"],[4,"IfcBuildingStorey"],[5,"IfcSpace"],[10,"IfcWall"],[11,"IfcWallStandardCase"],[12,"IfcDoor"],[13,"IfcWindow"],[14,"IfcSlab"],[15,"IfcColumn"],[16,"IfcBeam"],[17,"IfcStair"],[18,"IfcRamp"],[19,"IfcRoof"],[20,"IfcCovering"],[21,"IfcCurtainWall"],[22,"IfcRailing"],[30,"IfcOpeningElement"],[40,"IfcDistributionElement"],[41,"IfcFlowTerminal"],[42,"IfcFlowSegment"],[43,"IfcFlowFitting"],[100,"IfcRelContainedInSpatialStructure"],[101,"IfcRelAggregates"],[102,"IfcRelDefinesByProperties"],[103,"IfcRelDefinesByType"],[104,"IfcRelAssociatesMaterial"],[105,"IfcRelAssociatesClassification"],[106,"IfcRelVoidsElement"],[107,"IfcRelFillsElement"],[108,"IfcRelConnectsPathElements"],[109,"IfcRelSpaceBoundary"],[200,"IfcPropertySet"],[201,"IfcPropertySingleValue"],[202,"IfcPropertyEnumeratedValue"],[203,"IfcPropertyBoundedValue"],[204,"IfcPropertyListValue"],[210,"IfcElementQuantity"],[211,"IfcQuantityLength"],[212,"IfcQuantityArea"],[213,"IfcQuantityVolume"],[214,"IfcQuantityCount"],[215,"IfcQuantityWeight"],[300,"IfcWallType"],[301,"IfcDoorType"],[302,"IfcWindowType"],[303,"IfcSlabType"],[304,"IfcColumnType"],[305,"IfcBeamType"]]);function at(e){return it.get(e.toUpperCase())??9999}function ct(e){return ot.get(e)??"Unknown"}class lt{count=0;strings;expressId;typeEnum;globalId;name;description;objectType;flags;containedInStorey;definedByType;geometryIndex;typeStarts=new Map;typeCounts=new Map;constructor(t,s){this.strings=s,this.expressId=new Uint32Array(t),this.typeEnum=new Uint16Array(t),this.globalId=new Uint32Array(t),this.name=new Uint32Array(t),this.description=new Uint32Array(t),this.objectType=new Uint32Array(t),this.flags=new Uint8Array(t),this.containedInStorey=new Int32Array(t).fill(-1),this.definedByType=new Int32Array(t).fill(-1),this.geometryIndex=new Int32Array(t).fill(-1)}add(t,s,n,r,o,c,a=!1,u=!1){const i=this.count++;this.expressId[i]=t;const p=at(s);this.typeEnum[i]=p,this.globalId[i]=this.strings.intern(n),this.name[i]=this.strings.intern(r),this.description[i]=this.strings.intern(o),this.objectType[i]=this.strings.intern(c);let y=0;a&&(y|=j.HAS_GEOMETRY),u&&(y|=j.IS_TYPE),this.flags[i]=y,this.typeStarts.has(p)||(this.typeStarts.set(p,i),this.typeCounts.set(p,0)),this.typeCounts.set(p,this.typeCounts.get(p)+1)}build(){const t=l=>l.subarray(0,this.count),s=new Map;for(const[l,h]of this.typeStarts){const C=this.typeCounts.get(l);s.set(l,{start:h,end:h+C})}const n=t(this.expressId),r=t(this.typeEnum),o=t(this.globalId),c=t(this.name),a=t(this.description),u=t(this.objectType),i=t(this.flags),p=t(this.containedInStorey),y=t(this.definedByType),I=t(this.geometryIndex),g=new Map;for(let l=0;l<this.count;l++)g.set(n[l],l);const d=l=>g.get(l)??-1;return{count:this.count,expressId:n,typeEnum:r,globalId:o,name:c,description:a,objectType:u,flags:i,containedInStorey:p,definedByType:y,geometryIndex:I,typeRanges:s,getGlobalId:l=>{const h=d(l);return h>=0?this.strings.get(o[h]):""},getName:l=>{const h=d(l);return h>=0?this.strings.get(c[h]):""},getDescription:l=>{const h=d(l);return h>=0?this.strings.get(a[h]):""},getObjectType:l=>{const h=d(l);return h>=0?this.strings.get(u[h]):""},getTypeName:l=>{const h=d(l);return h>=0?ct(r[h]):"Unknown"},hasGeometry:l=>{const h=d(l);return h>=0?(i[h]&j.HAS_GEOMETRY)!==0:!1},getByType:l=>{const h=s.get(l);if(!h)return[];const C=[];for(let E=h.start;E<h.end;E++)C.push(n[E]);return C}}}}class ft{strings;rows=[];constructor(t){this.strings=t}add(t){this.rows.push(t)}build(){const t=this.rows.length,s=new Uint32Array(t),n=new Uint32Array(t),r=new Uint32Array(t),o=new Uint32Array(t),c=new Uint8Array(t),a=new Uint32Array(t),u=new Float64Array(t),i=new Int32Array(t),p=new Uint8Array(t).fill(255),y=new Int32Array(t).fill(-1),I=new Map,g=new Map,d=new Map;for(let C=0;C<t;C++){const E=this.rows[C];s[C]=E.entityId;const f=this.strings.intern(E.psetName),A=this.strings.intern(E.psetGlobalId),S=this.strings.intern(E.propName);switch(n[C]=f,r[C]=A,o[C]=S,c[C]=E.propType,E.propType){case T.String:case T.Label:case T.Identifier:case T.Text:case T.Enum:a[C]=this.strings.intern(E.value);break;case T.Real:u[C]=E.value;break;case T.Integer:i[C]=E.value;break;case T.Boolean:case T.Logical:p[C]=E.value===!0?1:E.value===!1?0:255;break;case T.List:a[C]=this.strings.intern(JSON.stringify(E.value));break}E.unitId!==void 0&&(y[C]=E.unitId),k(I,E.entityId,C),k(g,f,C),k(d,S,C)}const l=this.strings,h={count:t,entityId:s,psetName:n,psetGlobalId:r,propName:o,propType:c,valueString:a,valueReal:u,valueInt:i,valueBool:p,unitId:y,entityIndex:I,psetIndex:g,propIndex:d,getForEntity:C=>{const E=I.get(C)||[],f=new Map;for(const A of E){const S=l.get(n[A]),N=l.get(r[A]);f.has(S)||f.set(S,{name:S,globalId:N,properties:[]});const b=f.get(S),P=l.get(o[A]),x=z(h,A,l);b.properties.push({name:P,type:c[A],value:x})}return Array.from(f.values())},getPropertyValue:(C,E,f)=>{const A=I.get(C)||[],S=l.indexOf(E),N=l.indexOf(f);for(const b of A)if(n[b]===S&&o[b]===N)return z(h,b,l);return null},findByProperty:(C,E,f)=>{const A=l.indexOf(C);if(A<0)return[];const S=d.get(A)||[],N=[];for(const b of S){const P=z(h,b,l);It(P,E,f)&&N.push(s[b])}return N}};return h}}function k(e,t,s){let n=e.get(t);n||(n=[],e.set(t,n)),n.push(s)}function z(e,t,s){switch(e.propType[t]){case T.String:case T.Label:case T.Identifier:case T.Text:case T.Enum:return e.valueString[t]>=0?s.get(e.valueString[t]):null;case T.Real:return e.valueReal[t];case T.Integer:return e.valueInt[t];case T.Boolean:case T.Logical:const r=e.valueBool[t];return r===255?null:r===1;case T.List:const o=s.get(e.valueString[t]);try{return JSON.parse(o)}catch{return[]}default:return null}}function It(e,t,s){if(e===null||s===null)return!1;if(typeof e=="number"&&typeof s=="number")switch(t){case">=":return e>=s;case">":return e>s;case"<=":return e<=s;case"<":return e<s;case"=":case"==":return e===s;case"!=":return e!==s}if(typeof e=="string"&&typeof s=="string")switch(t){case"=":case"==":return e===s;case"!=":return e!==s;case"contains":return e.includes(s);case"startsWith":return e.startsWith(s)}return!1}class ut{strings;rows=[];constructor(t){this.strings=t}add(t){this.rows.push(t)}build(){const t=this.rows.length,s=new Uint32Array(t),n=new Uint32Array(t),r=new Uint32Array(t),o=new Uint8Array(t),c=new Float64Array(t),a=new Int32Array(t).fill(-1),u=new Uint32Array(t).fill(0),i=new Map,p=new Map,y=new Map;for(let I=0;I<t;I++){const g=this.rows[I];s[I]=g.entityId,n[I]=this.strings.intern(g.qsetName),r[I]=this.strings.intern(g.quantityName),o[I]=g.quantityType,c[I]=g.value,g.unitId!==void 0&&(a[I]=g.unitId),g.formula&&(u[I]=this.strings.intern(g.formula)),X(i,g.entityId,I),X(p,n[I],I),X(y,r[I],I)}return{count:t,entityId:s,qsetName:n,quantityName:r,quantityType:o,value:c,unitId:a,formula:u,entityIndex:i,qsetIndex:p,quantityIndex:y,getForEntity:I=>{const g=i.get(I)||[],d=new Map;for(const l of g){const h=this.strings.get(n[l]);d.has(h)||d.set(h,{name:h,quantities:[]});const C=d.get(h),E=this.strings.get(r[l]);C.quantities.push({name:E,type:o[l],value:c[l],formula:u[l]>0?this.strings.get(u[l]):void 0})}return Array.from(d.values())},getQuantityValue:(I,g,d)=>{const l=i.get(I)||[],h=this.strings.indexOf(g),C=this.strings.indexOf(d);for(const E of l)if(n[E]===h&&r[E]===C)return c[E];return null},sumByType:I=>{const g=this.strings.indexOf(I);if(g<0)return 0;const d=y.get(g)||[];let l=0;for(const h of d)l+=c[h];return l}}}}function X(e,t,s){let n=e.get(t);n||(n=[],e.set(t,n)),n.push(s)}class pt{edges=[];addEdge(t,s,n,r){this.edges.push({source:t,target:s,type:n,relId:r})}build(){const t=[...this.edges].sort((o,c)=>o.source-c.source),s=[...this.edges].sort((o,c)=>o.target-c.target),n=this.buildEdges(t,"source","target"),r=this.buildEdges(s,"target","source");return{forward:n,inverse:r,getRelated:(o,c,a)=>(a==="forward"?n.getEdges(o,c):r.getEdges(o,c)).map(i=>i.target),hasRelationship:(o,c,a)=>n.getEdges(o,a).some(i=>i.target===c),getRelationshipsBetween:(o,c)=>n.getEdges(o).filter(u=>u.target===c).map(u=>({relationshipId:u.relationshipId,type:u.type,typeName:ht(u.type)}))}}buildEdges(t,s,n){const r=new Map,o=new Map,c=new Uint32Array(t.length),a=new Uint16Array(t.length),u=new Uint32Array(t.length);let i=-1;for(let p=0;p<t.length;p++){const y=t[p],I=y[s];I!==i&&(r.set(I,p),i=I),o.set(I,(o.get(I)??0)+1),c[p]=y[n],a[p]=y.type,u[p]=y.relId}return{offsets:r,counts:o,edgeTargets:c,edgeTypes:a,edgeRelIds:u,getEdges(p,y){const I=r.get(p);if(I===void 0)return[];const g=o.get(p),d=[];for(let l=I;l<I+g;l++)(y===void 0||a[l]===y)&&d.push({target:c[l],type:a[l],relationshipId:u[l]});return d},getTargets(p,y){return this.getEdges(p,y).map(I=>I.target)},hasAnyEdges(p){return r.has(p)}}}}function ht(e){return{[R.ContainsElements]:"IfcRelContainedInSpatialStructure",[R.Aggregates]:"IfcRelAggregates",[R.DefinesByProperties]:"IfcRelDefinesByProperties",[R.DefinesByType]:"IfcRelDefinesByType",[R.AssociatesMaterial]:"IfcRelAssociatesMaterial",[R.AssociatesClassification]:"IfcRelAssociatesClassification",[R.VoidsElement]:"IfcRelVoidsElement",[R.FillsElement]:"IfcRelFillsElement",[R.ConnectsPathElements]:"IfcRelConnectsPathElements",[R.ConnectsElements]:"IfcRelConnectsElements",[R.SpaceBoundary]:"IfcRelSpaceBoundary",[R.AssignsToGroup]:"IfcRelAssignsToGroup",[R.AssignsToProduct]:"IfcRelAssignsToProduct",[R.ReferencedInSpatialStructure]:"ReferencedInSpatialStructure"}[e]||"Unknown"}class gt{build(t,s,n,r,o,c=1){const a=new Map,u=new Map,i=new Map,p=new Map,y=new Map,I=new Map,g=new Map,d=new Map;for(let f=0;f<t.count;f++)d.set(t.expressId[f],t.typeEnum[f]);const l=t.getByType(O.IfcProject);if(l.length===0)throw console.warn("[SpatialHierarchyBuilder] No IfcProject found in IFC file"),new Error("No IfcProject found in IFC file");const h=l[0],C=this.buildNode(h,t,s,n,r,o,a,u,i,p,y,g,d,c);for(const[f,A]of a)for(const S of A)g.set(S,f);return a.size===0&&console.warn("[SpatialHierarchyBuilder] No storeys found in spatial hierarchy"),u.size===0&&console.warn("[SpatialHierarchyBuilder] No buildings found in spatial hierarchy"),{project:C,byStorey:a,byBuilding:u,bySite:i,bySpace:p,storeyElevations:y,storeyHeights:I,elementToStorey:g,getStoreyElements(f){return a.get(f)??[]},getStoreyByElevation(f){let A=null,S=1/0;for(const[N,b]of y){const P=Math.abs(b-f);P<S&&(S=P,A=N)}return S<1?A:null},getContainingSpace(f){for(const[A,S]of p)if(S.includes(f))return A;return null},getPath(f){const A=[];if(!g.get(f))return A;const N=(b,P)=>{if(A.push(b),b.elements.includes(P))return!0;for(const x of b.children)if(N(x,P))return!0;return A.pop(),!1};return N(C,f),A}}}buildNode(t,s,n,r,o,c,a,u,i,p,y,I,g,d){const l=g.get(t)??O.Unknown,h=s.getName(t);let C;if(l===O.IfcBuildingStorey){const S=this.extractElevation(t,o,c);S!==void 0&&(C=S*d,y.set(t,C))}const E=n.getRelated(t,R.ContainsElements,"forward"),f=n.getRelated(t,R.Aggregates,"forward"),A=[];for(const S of f){const N=g.get(S)??O.Unknown;if(N===O.IfcSite||N===O.IfcBuilding||N===O.IfcBuildingStorey||N===O.IfcSpace){const b=this.buildNode(S,s,n,r,o,c,a,u,i,p,y,I,g,d);A.push(b)}}return l===O.IfcBuildingStorey?a.set(t,E):l===O.IfcBuilding?u.set(t,E):l===O.IfcSite?i.set(t,E):l===O.IfcSpace&&p.set(t,E),{expressId:t,type:l,name:h,elevation:C,children:A,elements:E}}extractElevation(t,s,n){const r=n.byId.get(t);if(r)try{const c=new G(s).extractEntity(r);if(!c)return;const a=c.attributes||[],u=i=>{if(typeof i=="number")return i;if(Array.isArray(i)&&i.length===2&&typeof i[1]=="number")return i[1]};if(a.length>9){const i=u(a[9]);if(i!==void 0)return i}if(a.length>8){const i=u(a[8]);if(i!==void 0)return i}for(let i=0;i<a.length;i++){const p=u(a[i]);if(p!==void 0&&Math.abs(p)<1e4)return p}}catch{}}}const Z={ATTO:1e-18,FEMTO:1e-15,PICO:1e-12,NANO:1e-9,MICRO:1e-6,MILLI:.001,CENTI:.01,DECI:.1,DECA:10,HECTO:100,KILO:1e3,MEGA:1e6,GIGA:1e9,TERA:1e12,PETA:1e15,EXA:1e18},dt={FOOT:.3048,FEET:.3048,"'FOOT'":.3048,INCH:.0254,"'INCH'":.0254,YARD:.9144,"'YARD'":.9144,MILE:1609.344,"'MILE'":1609.344};function Et(e,t){const s=new G(e),n=t.byType.get("IFCPROJECT")||[];if(n.length===0)return console.warn("[UnitExtractor] No IFCPROJECT found, defaulting to meters"),1;const r=t.byId.get(n[0]);if(!r)return 1;const o=s.extractEntity(r);if(!o)return 1;const a=(o.attributes||[])[8];if(typeof a!="number")return console.warn("[UnitExtractor] No UnitsInContext reference, defaulting to meters"),1;const u=t.byId.get(a);if(!u)return 1;const i=s.extractEntity(u);if(!i||i.type.toUpperCase()!=="IFCUNITASSIGNMENT"||!i.attributes||!Array.isArray(i.attributes))return 1;const p=i.attributes[0];if(!Array.isArray(p))return 1;for(const y of p){if(typeof y!="number")continue;const I=t.byId.get(y);if(!I)continue;const g=s.extractEntity(I);if(!g)continue;const d=g.type.toUpperCase(),l=g.attributes||[];if(d==="IFCSIUNIT"){const h=l[1];if(!(typeof h=="string"&&h.replace(/\./g,"").toUpperCase()==="LENGTHUNIT"))continue;const E=l[2];if(E==null||E==="$")return 1;const f=typeof E=="string"?E.replace(/\./g,"").toUpperCase():"",A=Z[f];return A!==void 0?(console.log(`[UnitExtractor] Found SI unit with prefix ${f}, scale = ${A}`),A):1}if(d==="IFCCONVERSIONBASEDUNIT"){const h=l[1];if(!(typeof h=="string"&&h.replace(/\./g,"").toUpperCase()==="LENGTHUNIT"))continue;const E=l[2];if(typeof E=="string"){const A=E.toUpperCase(),S=dt[A];if(S!==void 0)return console.log(`[UnitExtractor] Found conversion-based unit ${E}, scale = ${S}`),S}const f=l[3];if(typeof f=="number"){const A=t.byId.get(f);if(A){const S=s.extractEntity(A);if(S){const N=S.attributes[0],b=S.attributes[1];let P;if(typeof N=="number"?P=N:Array.isArray(N)&&N.length===2&&typeof N[1]=="number"&&(P=N[1]),P!==void 0&&P>0){let x=1;if(typeof b=="number"){const W=t.byId.get(b);if(W){const Y=s.extractEntity(W);if(Y&&Y.type.toUpperCase()==="IFCSIUNIT"){const M=(Y.attributes||[])[2];if(M!=null&&M!=="$"){const F=typeof M=="string"?M.replace(/\./g,"").toUpperCase():"",L=Z[F];L!==void 0&&(x=L)}}}}const _=P*x;return console.log(`[UnitExtractor] Found conversion factor ${P} * ${x} = ${_} from IFCMEASUREWITHUNIT`),_}}}}}}return console.warn("[UnitExtractor] No length unit found, defaulting to meters"),1}const Ct=new Set(["IFCWALL","IFCWALLSTANDARDCASE","IFCDOOR","IFCWINDOW","IFCSLAB","IFCCOLUMN","IFCBEAM","IFCROOF","IFCSTAIR","IFCSTAIRFLIGHT","IFCRAILING","IFCRAMP","IFCRAMPFLIGHT","IFCPLATE","IFCMEMBER","IFCCURTAINWALL","IFCFOOTING","IFCPILE","IFCBUILDINGELEMENTPROXY","IFCFURNISHINGELEMENT","IFCFLOWSEGMENT","IFCFLOWTERMINAL","IFCFLOWCONTROLLER","IFCFLOWFITTING","IFCSPACE","IFCOPENINGELEMENT","IFCSITE","IFCBUILDING","IFCBUILDINGSTOREY"]),yt={IFCRELCONTAINEDINSPATIALSTRUCTURE:R.ContainsElements,IFCRELAGGREGATES:R.Aggregates,IFCRELDEFINESBYPROPERTIES:R.DefinesByProperties,IFCRELDEFINESBYTYPE:R.DefinesByType,IFCRELASSOCIATESMATERIAL:R.AssociatesMaterial,IFCRELASSOCIATESCLASSIFICATION:R.AssociatesClassification,IFCRELVOIDSELEMENT:R.VoidsElement,IFCRELFILLSELEMENT:R.FillsElement,IFCRELCONNECTSPATHELEMENTS:R.ConnectsPathElements,IFCRELCONNECTSELEMENTS:R.ConnectsElements,IFCRELSPACEBOUNDARY:R.SpaceBoundary,IFCRELASSIGNSTOGROUP:R.AssignsToGroup,IFCRELASSIGNSTOPRODUCT:R.AssignsToProduct,IFCRELREFERENCEDINSPATIALSTRUCTURE:R.ReferencedInSpatialStructure},At={IFCQUANTITYLENGTH:D.Length,IFCQUANTITYAREA:D.Area,IFCQUANTITYVOLUME:D.Volume,IFCQUANTITYCOUNT:D.Count,IFCQUANTITYWEIGHT:D.Weight,IFCQUANTITYTIME:D.Time},tt=new Set(["IFCPROJECT","IFCSITE","IFCBUILDING","IFCBUILDINGSTOREY","IFCSPACE"]),St=new Set(["IFCRELAGGREGATES","IFCRELCONTAINEDINSPATIALSTRUCTURE"]),Rt=new Set(["IFCRELDEFINESBYPROPERTIES"]),Ft=new Set(["IFCPROPERTYSET","IFCELEMENTQUANTITY","IFCPROPERTYSINGLEVALUE","IFCPROPERTYENUMERATEDVALUE","IFCPROPERTYBOUNDEDVALUE","IFCPROPERTYTABLEVALUE","IFCPROPERTYLISTVALUE","IFCPROPERTYREFERENCEVALUE","IFCQUANTITYLENGTH","IFCQUANTITYAREA","IFCQUANTITYVOLUME","IFCQUANTITYCOUNT","IFCQUANTITYWEIGHT","IFCQUANTITYTIME"]);class Nt{async parseLite(t,s,n={}){const r=performance.now(),o=new Uint8Array(t),c=s.length;n.onProgress?.({phase:"building",percent:0});const a=new rt,u=new lt(c,a),i=new ft(a),p=new ut(a),y=new pt,I={byId:new Map,byType:new Map},g=[],d=[],l=[];for(const F of s){I.byId.set(F.expressId,F);let L=I.byType.get(F.type);L||(L=[],I.byType.set(F.type,L)),L.push(F.expressId);const w=F.type.toUpperCase();tt.has(w)?g.push(F):St.has(w)?d.push(F):Rt.has(w)?l.push(F):Ft.has(w)}n.onProgress?.({phase:"parsing spatial",percent:10});const h=new G(o),C=new Map;for(const F of g){const L=h.extractEntity(F);if(L){const w=L.attributes||[],m=typeof w[0]=="string"?w[0]:"",U=typeof w[2]=="string"?w[2]:"";C.set(F.expressId,{globalId:m,name:U})}}console.log(`[ColumnarParser] Parsed ${g.length} spatial entities`),n.onProgress?.({phase:"parsing relationships",percent:20});const E=[];for(const F of d){const L=h.extractEntity(F);if(L){const w=L.type.toUpperCase(),m=this.extractRelationshipFast(L,w);if(m){E.push(m);const U=yt[w];if(U)for(const V of m.relatedObjects)y.addEdge(m.relatingObject,V,U,m.relatingObject)}}}console.log(`[ColumnarParser] Parsed ${d.length} relationship entities, ${E.length} valid relationships`),n.onProgress?.({phase:"parsing property refs",percent:25});const f=new Map,A=new Map;for(const F of l){const L=h.extractEntity(F);if(L){const w=L.attributes||[],m=w[4],U=w[5];if(typeof U=="number"&&Array.isArray(m)){for(const B of m)typeof B=="number"&&y.addEdge(U,B,R.DefinesByProperties,F.expressId);const V=I.byId.get(U);if(V){const B=V.type.toUpperCase(),H=B==="IFCPROPERTYSET";if(H||B==="IFCELEMENTQUANTITY"){const q=H?f:A;for(const $ of m)if(typeof $=="number"){let v=q.get($);v||(v=[],q.set($,v)),v.push(U)}}}}}}console.log(`[ColumnarParser] On-demand: ${f.size} entities with properties, ${A.size} with quantities`),n.onProgress?.({phase:"building entities",percent:30});const S=new Set(["IFCWALL","IFCSLAB","IFCBEAM","IFCCOLUMN","IFCPLATE","IFCDOOR","IFCWINDOW","IFCROOF","IFCSTAIR","IFCRAILING","IFCRAMP","IFCFOOTING","IFCPILE","IFCMEMBER","IFCCURTAINWALL","IFCBUILDINGELEMENTPROXY","IFCFURNISHINGELEMENT","IFCFLOWSEGMENT","IFCFLOWTERMINAL","IFCFLOWCONTROLLER","IFCFLOWFITTING","IFCSPACE","IFCOPENINGELEMENT","IFCSITE","IFCBUILDING","IFCBUILDINGSTOREY","IFCPROJECT","IFCCOVERING","IFCANNOTATION","IFCGRID"]);let N=0,b=0;for(const F of s){const L=F.type.toUpperCase(),w=Ct.has(L),m=L.endsWith("TYPE"),U=tt.has(L);if(!(w||m||U||S.has(L)||L.startsWith("IFCREL")||f.has(F.expressId)||A.has(F.expressId))){N++;continue}const B=C.get(F.expressId),H=B?.globalId||"",J=B?.name||"";u.add(F.expressId,F.type,H,J,"","",w,m),b++,N++,N%1e4===0&&(n.onProgress?.({phase:"building entities",percent:30+N/c*50}),await new Promise(q=>setTimeout(q,0)))}console.log(`[ColumnarParser] Added ${b} relevant entities (skipped ${c-b} primitives)`);const P=u.build(),x=i.build(),_=p.build(),W=y.build();n.onProgress?.({phase:"extracting units",percent:85});const Y=Et(o,I);console.log(`[ColumnarParser] Length unit scale: ${Y}`),n.onProgress?.({phase:"building hierarchy",percent:90});let Q;try{Q=new gt().build(P,W,a,o,I,Y),console.log(`[ColumnarParser] Built spatial hierarchy with ${Q.byStorey.size} storeys`)}catch(F){console.warn("[ColumnarParser] Failed to build spatial hierarchy:",F)}const M=performance.now()-r;return console.log(`[ColumnarParser] Parsed ${c} entities in ${M.toFixed(0)}ms`),n.onProgress?.({phase:"complete",percent:100}),{fileSize:t.byteLength,schemaVersion:"IFC4",entityCount:c,parseTime:M,source:o,entityIndex:I,strings:a,entities:P,properties:x,quantities:_,relationships:W,spatialHierarchy:Q,onDemandPropertyMap:f,onDemandQuantityMap:A}}extractRelationshipFast(t,s){const n=t.attributes;if(n.length<6)return null;let r,o;return s==="IFCRELDEFINESBYPROPERTIES"||s==="IFCRELCONTAINEDINSPATIALSTRUCTURE"?(o=n[4],r=n[5]):(r=n[4],o=n[5]),typeof r!="number"||!Array.isArray(o)?null:{type:t.type,relatingObject:r,relatedObjects:o.filter(c=>typeof c=="number")}}extractPropertiesOnDemand(t,s){if(!t.onDemandPropertyMap)return t.properties.getForEntity(s);const n=t.onDemandPropertyMap.get(s);if(!n||n.length===0)return[];const r=new G(t.source),o=[];for(const c of n){const a=t.entityIndex.byId.get(c);if(!a)continue;const u=r.extractEntity(a);if(!u)continue;const i=u.attributes||[],p=typeof i[0]=="string"?i[0]:void 0,y=typeof i[2]=="string"?i[2]:`PropertySet #${c}`,I=i[4],g=[];if(Array.isArray(I))for(const d of I){if(typeof d!="number")continue;const l=t.entityIndex.byId.get(d);if(!l)continue;const h=r.extractEntity(l);if(!h)continue;const C=h.attributes||[],E=typeof C[0]=="string"?C[0]:"";if(!E)continue;const f=C[2];let A=0,S=f;typeof f=="number"?A=1:typeof f=="boolean"?A=2:f!=null&&(S=String(f)),g.push({name:E,type:A,value:S})}(g.length>0||y)&&o.push({name:y,globalId:p,properties:g})}return o}extractQuantitiesOnDemand(t,s){if(!t.onDemandQuantityMap)return t.quantities.getForEntity(s);const n=t.onDemandQuantityMap.get(s);if(!n||n.length===0)return[];const r=new G(t.source),o=[];for(const c of n){const a=t.entityIndex.byId.get(c);if(!a)continue;const u=r.extractEntity(a);if(!u)continue;const i=u.attributes||[],p=typeof i[2]=="string"?i[2]:`QuantitySet #${c}`,y=i[5],I=[];if(Array.isArray(y))for(const g of y){if(typeof g!="number")continue;const d=t.entityIndex.byId.get(g);if(!d)continue;const l=r.extractEntity(d);if(!l)continue;const h=l.attributes||[],C=typeof h[0]=="string"?h[0]:"";if(!C)continue;const E=l.type.toUpperCase(),f=At[E]??D.Count,A=typeof h[3]=="number"?h[3]:0;I.push({name:C,type:f,value:A})}(I.length>0||p)&&o.push({name:p,quantities:I})}return o}}class bt{async parse(t,s={}){const n=new Uint8Array(t);s.onProgress?.({phase:"scan",percent:0});const r=new K(n),o=new et,c=[];for(const d of r.scanEntities())o.addEntity({expressId:d.expressId,type:d.type,byteOffset:d.offset,byteLength:d.length,lineNumber:d.line}),c.push({expressId:d.expressId,type:d.type,byteOffset:d.offset,byteLength:d.length,lineNumber:d.line});const a=o.build();s.onProgress?.({phase:"scan",percent:100}),s.onProgress?.({phase:"extract",percent:0});const u=new G(n),i=new Map;for(let d=0;d<c.length;d++){const l=c[d],h=u.extractEntity(l);h&&i.set(l.expressId,h),(d+1)%1e3===0&&s.onProgress?.({phase:"extract",percent:(d+1)/c.length*100})}s.onProgress?.({phase:"extract",percent:100}),s.onProgress?.({phase:"properties",percent:0});const y=new st(i).extractPropertySets();s.onProgress?.({phase:"properties",percent:100}),s.onProgress?.({phase:"relationships",percent:0});const g=new nt(i).extractRelationships();return s.onProgress?.({phase:"relationships",percent:100}),{entities:i,propertySets:y,relationships:g,entityIndex:a,fileSize:t.byteLength,entityCount:i.size}}async parseColumnar(t,s={}){const n=new Uint8Array(t),r=performance.now(),o=t.byteLength/(1024*1024);console.log(`[IfcParser] Parsing ${o.toFixed(1)}MB file with on-demand property extraction`),s.onProgress?.({phase:"scanning",percent:0});let c=[],a=0;if(s.wasmApi&&typeof s.wasmApi.scanEntitiesFast=="function")try{const y=new TextDecoder().decode(t);c=s.wasmApi.scanEntitiesFast(y).map(g=>({expressId:g.express_id,type:g.entity_type,byteOffset:g.byte_offset,byteLength:g.byte_length,lineNumber:g.line_number})),a=c.length,console.log(`[IfcParser] WASM scan: ${a} entities`)}catch(p){console.warn("[IfcParser] WASM scan failed, falling back to TypeScript:",p),c.length=0,a=0}if(c.length===0){const p=new K(n),y=5e3,I=Math.max(o*13500,1e4);for(const g of p.scanEntitiesFast())if(c.push({expressId:g.expressId,type:g.type,byteOffset:g.offset,byteLength:g.length,lineNumber:g.line}),a++,a%y===0){const d=Math.min(95,a/I*95);s.onProgress?.({phase:"scanning",percent:d}),await new Promise(l=>setTimeout(l,0))}}const u=performance.now()-r;return console.log(`[IfcParser] Fast scan: ${a} entities in ${u.toFixed(0)}ms`),s.onProgress?.({phase:"scanning",percent:100}),new Nt().parseLite(t,c,s)}}self.onmessage=async e=>{const{buffer:t,id:s}=e.data;try{const r=await new bt().parseColumnar(t,{onProgress:o=>{self.postMessage({type:"progress",id:s,progress:o})}});self.postMessage({type:"complete",id:s,dataStore:r})}catch(n){self.postMessage({type:"error",id:s,error:n instanceof Error?n.message:String(n)})}};
